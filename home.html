<!DOCTYPE html>
<html>
<head>
  <title>Home - FinTrack</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body, html {
  height: 100%;
  margin: 0;
}

.bg {
  background-image: url("img/bg.png");
  height: 100%;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
}

.rounded-corners {
  position: relative;
  border-radius: 25px;
  border: 2px solid #030126;
  padding: 20px;
  width: 500px;
  height: 550px;
  background-color: #030126;
  margin: auto;
}
.rounded-corners-balance {
  position: relative;
  border-radius: 25px;
  border: 2px solid #027ddb;
  padding: 20px;
  width: 200px;
  height: 150px;
  background-color: #027ddb;
  margin: auto;
}
.text {
  color: white;
  font-family: "Times New Roman", Times, serif;
  margin-left: 10px;
  display: inline-block;
  vertical-align: middle;
}

/* Original size for main icons */
img {
  width: 50px;
  height: 50px;
}

/* Smaller size for delete icons in tables */
.delete-item-icon {
  width: 20px; /* Reduced width */
  height: 20px; /* Reduced height */
}

#profileIcon {
  position: absolute;
  top: 10px;
  left: 10px;
}

#welcomeMessage {
  position: absolute;
  top: 15px;
  left: 70px;
}

#deleteButton {
  position: absolute;
  top: 10px;
  right: 10px;
  width: 30px;
  height: 30px;
  cursor: pointer;
}

#addButton {
  position: absolute;
  top: 10px;
  right: 50px;
  width: 30px;
  height: 30px;
  cursor: pointer;
}

.dropdown {
  display: none;
  position: absolute;
  top: 50px;
  right: 50px;
  background-color:#03c6fc;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
  border-radius: 4px;
}

.dropdown a {
  color: white;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  background-color: #03c6fc;
  border-radius: 4px;
}

.dropdown a:hover {background-color: #027ddb;}

table {
  width: 100%;
  color: white;
  border-collapse: collapse;
  table-layout: fixed; /* Ensure fixed layout for table cells */
}

.note-text {
  display: block; /* Ensure the text is displayed as a block */
  word-break: break-all; /* Break long words to prevent horizontal scrolling */
  max-width: 100%; /* Ensure it doesn't overflow horizontally */
}

td {
  vertical-align: top; /* Align text to the top of the cell */
  word-wrap: break-word; /* Ensure text wraps within the cell */
}

th, td {
  padding: 8px;
  border-bottom: 1px solid white;
  text-align: left;
}

.tab {
  overflow: hidden;
  border-bottom: 1px solid #ccc;
  border-radius: 4px;
}

.tab button {
  background-color: white;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
  font-size: 17px;
  color: black;
  border-radius: 4px;
}

.income-amount {
  color: #2ecc71; /* Green color for income */
}

.expense-amount {
  color: #e74c3c; /* Red color for expense */
}

.tab button:hover {
  background-color: #027ddb;
  color: black;
  border-radius: 4px;
}

.tab button.active {
  background-color: #03c6fc;
  color: black;
  border-radius: 4px;
}

.tabcontent {
  display: none;
  padding: 6px 12px;
  border-top: none;
  color: white;
  border-radius: 4px;
  height: 400px; /* Set a fixed height for the scrollable area */
  overflow-y: auto; /* Enable vertical scrolling */
}

/* Added for Show More/Less button */
.show-more-button {
  background: none;
  border: none;
  color: #03c6fc; /* Or any color you prefer */
  cursor: pointer;
  padding: 0;
  font-size: inherit;
  text-decoration: underline;
  margin-left: 5px;
}
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

.modal-content {
  background-color: #030126;
  margin: 15% auto; /* 15% from the top and centered */
  padding: 20px;
  border: 1px solid #888;
  width: 30%; /* Could be more or less, depending on screen size */
  border-radius: 10px;
  color:white;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #03c6fc;
  text-decoration: none;
  cursor: pointer;
}

  #editButton {
  position: absolute;
  top: 10px;
  right: 90px; /* Adjust this value to position it correctly */
  width: 30px;
  height: 30px;
  cursor: pointer;
}
.input {
  border: none;
  border-bottom: 2px solid #03c6fc;
  padding: 10px;
  width: 70%;
  box-sizing: border-box;
  background-color: #030126;
  outline: none;
  color: white;
  font-family: "Times New Roman", Times, serif;
  font-size: 18px;
  margin: 0 auto;
  display: block;
}

  .button {
  background-color: #03c6fc;
  border: none;
  color: white;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  display: block;
  font-size: 18px;
  margin: 20px auto;
  cursor: pointer;
  border-radius: 5px;
  width: 70%; /* Match the input width */
  box-sizing: border-box;
}
</style>
</head>
<body class="bg">
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<div class="rounded-corners" id="contentDiv">
  <img id="profileIcon" src="img/profile.png" alt="profile">
  <p id="welcomeMessage" class="text">Welcome!</p>
  <img id="addButton" src="img/add.png" alt="Add" title="Add">
  <img id="deleteButton" src="img/delete.png" alt="Delete Account" title="Delete Account">
  <img id="editButton" src="img/edit-profile.png" alt="Edit Profile" title="Edit Profile">
<br>
  <br>
  <br>
  <div class="rounded-corners-balance" id="summary">
  <div class="details">
    <div class="total">
      <p class="text">Total Balance</p>
      <strong class="text totalBalance">0</strong>
    </div>
    <div class="detail">
      <div class="income">
        <p class="text">Income</p>
        <strong class="text incomeBalance income-amount">0</strong>
      </div>
      <div class="expense">
        <p class="text">Expense</p>
        <strong class="text expenseBalance expense-amount">0</strong>
      </div>
    </div>
  </div>
</div>



<div id="editProfileModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Edit Profile</h2>
    <label for="username">Username:</label>
    <input type="text" id="username" name="username" class="input">
    <button id="saveButton" class="button">Save</button>
  </div>
</div>


  <div id="addDropdown" class="dropdown">
    <a id="incomeOption">Income</a>
    <a id="expenseOption">Expense</a>
  </div>
<br>
 <br>
 <br>
 <br>
  <div class="tab">
    <button class="tablinks" onclick="openTab(event, 'Income')" id="defaultOpen">Income</button>
    <button class="tablinks" onclick="openTab(event, 'Expense')">Expense</button>
  </div>

  <div id="Income" class="tabcontent">
    <h2>Income List</h2>
    <table id="incomeTable">
      <thead>
        <tr>
          <th>Amount</th>
          <th>Category</th>
          <th>Notes</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="incomeItems">
        </tbody>
    </table>
  </div>

  <div id="Expense" class="tabcontent">
    <h2>Expense List</h2>
    <table id="expenseTable">
      <thead>
        <tr>
          <th>Amount</th>
          <th>Category</th>
          <th>Notes</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="expenseItems">
        </tbody>
    </table>
  </div>
</div>
</body>
<script>
  window.deleteIncome = function(index) {
  var confirmation = confirm("Are you sure you want to delete this income entry?");
  if (confirmation) {
    const incomeList = JSON.parse(localStorage.getItem("incomeList")) || [];
    incomeList.splice(index, 1);
    localStorage.setItem("incomeList", JSON.stringify(incomeList));
    updateBalances(); // Update balances after deletion
    location.reload();
  }
}

window.deleteExpense = function(index) {
  var confirmation = confirm("Are you sure you want to delete this expense entry?");
  if (confirmation) {
    const expenseList = JSON.parse(localStorage.getItem("expenseList")) || [];
    expenseList.splice(index, 1);
    localStorage.setItem("expenseList", JSON.stringify(expenseList));
    updateBalances(); // Update balances after deletion
    location.reload();
  }
}


  document.addEventListener("DOMContentLoaded", function() {
    var name = localStorage.getItem("user");
    if (name) {
      document.getElementById("welcomeMessage").innerText += " " + name;
    }
    updateBalances();

    const maxNoteLength = 6;

    const incomeList = JSON.parse(localStorage.getItem("incomeList")) || [];
    const incomeItems = document.getElementById("incomeItems");

    incomeList.forEach((income, index) => {
      const row = document.createElement('tr');
      const originalNotes = income.notes;
      const truncatedNotes = originalNotes.length > maxNoteLength ? originalNotes.substring(0, maxNoteLength) + '...' : originalNotes;
      const showMoreButtonHtml = originalNotes.length > maxNoteLength ? `<button class="show-more-button" onclick="toggleNoteVisibility(this, \`${originalNotes}\`)">Show More</button>` : '';

      row.innerHTML = `
        <td class="income-amount">$${income.amount}</td>
        <td>${income.type}</td>
        <td><span class="note-text">${truncatedNotes}</span> ${showMoreButtonHtml}</td>
        <td><img src="img/delete.png" alt="Delete" class="delete-item-icon" style="cursor: pointer;" onclick="deleteIncome(${index})"></td>
      `;
      incomeItems.appendChild(row);
    });

    const expenseList = JSON.parse(localStorage.getItem("expenseList")) || [];
    const expenseItems = document.getElementById("expenseItems");

    expenseList.forEach((expense, index) => {
      const row = document.createElement('tr');
      const originalNotes = expense.notes;
      const truncatedNotes = originalNotes.length > maxNoteLength ? originalNotes.substring(0, maxNoteLength) + '...' : originalNotes;
      const showMoreButtonHtml = originalNotes.length > maxNoteLength ? `<button class="show-more-button" onclick="toggleNoteVisibility(this, \`${originalNotes}\`)">Show More</button>` : '';

      row.innerHTML = `
        <td class="expense-amount">$${expense.amount}</td>
        <td>${expense.type}</td>
        <td><span class="note-text">${truncatedNotes}</span> ${showMoreButtonHtml}</td>
        <td><img src="img/delete.png" alt="Delete" class="delete-item-icon" style="cursor: pointer;" onclick="deleteExpense(${index})"></td>
      `;
      expenseItems.appendChild(row);
    });

    document.getElementById("deleteButton").addEventListener("click", function() {
      var confirmation = confirm("Are you sure you want to delete your account? All your data will be permanently lost.");
      if (confirmation) {
        localStorage.removeItem("user");
        localStorage.removeItem("incomeList");
        localStorage.removeItem("expenseList");
        window.location.href = "index.html";
      }
    });

    document.getElementById("addButton").addEventListener("click", function() {
      var dropdown = document.getElementById("addDropdown");
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    });

    document.getElementById("incomeOption").addEventListener("click", function() {
      window.location.href = "income.html";
    });

    document.getElementById("expenseOption").addEventListener("click", function() {
      window.location.href = "expense.html"; // Assuming you have an expense.html for adding expenses
    });

    document.getElementById("defaultOpen").click();
  });

  // This window.onclick will be overridden by the editButton click handler
  // The functionality is preserved in the editButton click handler

  function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
  }

  function toggleNoteVisibility(button, fullNote) {
    const noteSpan = button.previousElementSibling; // Get the span element containing the note
    const maxNoteLength = 6;

    if (noteSpan.textContent.includes('...')) {
      // Currently truncated, show full note
      noteSpan.textContent = fullNote;
      button.innerText = "Show Less";
    } else {
      // Currently showing full note, truncate it
      noteSpan.textContent = fullNote.substring(0, maxNoteLength) + '...';
      button.innerText = "Show More";
    }
  }

  document.getElementById("editButton").addEventListener("click", function() {
  var modal = document.getElementById("editProfileModal");
  var span = document.getElementsByClassName("close")[0];
  var saveButton = document.getElementById("saveButton");
  var usernameInput = document.getElementById("username");

  // Open the modal
  modal.style.display = "block";

  // Load the current username into the input field
  usernameInput.value = localStorage.getItem("user") || "";

  // When the user clicks on <span> (x), close the modal
  span.onclick = function() {
    modal.style.display = "none";
  }

  // Add modal click outside handler
  var originalWindowClick = window.onclick;
  window.onclick = function(event) {
    // Handle modal close
    if (event.target == modal) {
      modal.style.display = "none";
    }
    // Call the original window.onclick handler for the dropdown
    else if (!event.target.matches('#addButton')) {
      var dropdowns = document.getElementsByClassName("dropdown");
      for (var i = 0; i < dropdowns.length; i++) {
        var openDropdown = dropdowns[i];
        if (openDropdown.style.display === "block") {
          openDropdown.style.display = "none";
        }
      }
    }
  }

  saveButton.onclick = function() {
    var newUsername = usernameInput.value;
    localStorage.setItem("user", newUsername);
    document.getElementById("welcomeMessage").innerText = "Welcome! " + newUsername;
    modal.style.display = "none";
  }
});
function updateBalances() {
  const incomeList = JSON.parse(localStorage.getItem("incomeList")) || [];
  const expenseList = JSON.parse(localStorage.getItem("expenseList")) || [];

  // Calculate total income
  const totalIncome = incomeList.reduce((sum, income) => sum + parseFloat(income.amount), 0);

  // Calculate total expense
  const totalExpense = expenseList.reduce((sum, expense) => sum + parseFloat(expense.amount), 0);

  // Calculate total balance
  const totalBalance = totalIncome - totalExpense;

  // Update the display
  document.querySelector('.totalBalance').textContent = `$${totalBalance.toFixed(2)}`;
  document.querySelector('.incomeBalance').textContent = `$${totalIncome.toFixed(2)}`;
  document.querySelector('.expenseBalance').textContent = `$${totalExpense.toFixed(2)}`;
}

// Call updateBalances after loading the data
// updateBalances() is already called in the DOMContentLoaded event handler


</script>
</html>